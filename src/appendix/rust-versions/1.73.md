# Rust æ–°ç‰ˆè§£è¯» | 1.73 | panic æŠ¥é”™å±•ç¤ºä¼˜åŒ–

> Rust 1.73 å®˜æ–¹ release doc: [Announcing Rust 1.73.0 | Rust Blog](https://blog.rust-lang.org/2023/10/05/Rust-1.73.0.html)

é€šè¿‡ [rustup](https://www.rust-lang.org/tools/install) å®‰è£…çš„åŒå­¦å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‡çº§åˆ° 1.73 ç‰ˆæœ¬:

```shell
$ rustup update stable
```

## æ›´ç®€æ´çš„ panic æŠ¥é”™ä¿¡æ¯

é»˜è®¤çš„ panic handler ä¼šæŠŠæŠ¥é”™ä¿¡æ¯å•ç‹¬åˆ—å‡ºä¸€è¡Œï¼Œå½“æŠ¥é”™ä¿¡æ¯å¾ˆé•¿ã€åŒ…å«å¤šè¡Œæˆ–è€…åµŒå¥—ç»“æ„çš„æ—¶å€™å¯è¯»æ€§ä¼šæ›´å¼ºã€‚

```rust
fn main() {
    let file = "ferris.txt";
    panic!("oh no! {file:?} not found!");
}
```

Rust 1.73 ä¹‹å‰çš„ï¼š
```shell
thread 'main' panicked at 'oh no! "ferris.txt" not found!', src/main.rs:3:5
```

Rust 1.73 ä¹‹åçš„ï¼š
```shell
thread 'main' panicked at src/main.rs:3:5:
oh no! "ferris.txt" not found!
```

å¦å¤–ï¼Œç”± `assert_eq` å’Œ `assert_ne` äº§ç”Ÿçš„ panic æ¶ˆæ¯ä¹ŸæŠŠè‡ªå®šä¹‰ä¿¡æ¯éƒ¨åˆ†ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰çš„å±•ç¤ºä½ç½®æ”¹åŠ¨äº†ä¸€ä¸‹ï¼š

```rust
fn main() {
    assert_eq!("ğŸ¦€", "ğŸŸ", "ferris is not a fish");
}
```

Rust 1.73 ä¹‹å‰çš„ï¼š
```shell
thread 'main' panicked at 'assertion failed: `(left == right)`
 left: `"ğŸ¦€"`,
right: `"ğŸŸ"`: ferris is not a fish', src/main.rs:2:5
```

Rust 1.73 ä¹‹åçš„ï¼š
```shell
thread 'main' panicked at src/main.rs:2:5:
assertion `left == right` failed: ferris is not a fish
 left: "ğŸ¦€"
right: "ğŸŸ"
```

## çº¿ç¨‹å±€éƒ¨åˆå§‹åŒ–

å¦‚ [RFC 3184](https://github.com/rust-lang/rfcs/blob/master/text/3184-thread-local-cell-methods.md) ææ¡ˆï¼Œ `LocalKey<Cell<T>>` å’Œ `LocalKey<RefCell<T>>` ç°åœ¨å¯ä»¥ç›´æ¥ç”¨ `get()`, `set()`, `take()` å’Œ `replace()` æ–¹æ³•æ¥æ“ä½œï¼Œä¸å†éœ€è¦å†™ `with(|inner|...)` çš„é—­åŒ…å½¢å¼ã€‚å£°æ˜çº¿ç¨‹é™æ€å±€éƒ¨å˜é‡çš„å® `thread_local!` å†…éƒ¨å°±æ˜¯ä½¿ç”¨çš„å°±æ˜¯ `LocalKey<T>`ã€‚

æ–°çš„æ–¹æ³•è®©ä»£ç æ›´ç®€æ´ï¼Œä¹Ÿé¿å…äº†é»˜è®¤å€¼åœ¨æ–°çº¿ç¨‹è¿è¡Œé¢å¤–çš„åˆå§‹åŒ–ä»£ç ã€‚

```rust
thread_local! {
    static THINGS: Cell<Vec<i32>> = Cell::new(Vec::new());
}

fn f() {
    // before:
    THINGS.with(|i| i.set(vec![1, 2, 3]));
    // now:
    THINGS.set(vec![1, 2, 3]);

    // ...

    // before:
    let v = THINGS.with(|i| i.take());
    // now:
    let v: Vec<i32> = THINGS.take();
}
```

## Others

å…¶å®ƒæ›´æ–°ç»†èŠ‚ï¼Œå’Œç¨³å®šçš„APIåˆ—è¡¨ï¼Œå‚è€ƒ[åŸBlog](https://blog.rust-lang.org/2023/10/05/Rust-1.73.0.html#stabilized-apis)
